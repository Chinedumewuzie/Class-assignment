<!DOCTYPE html>
<html>
<head>
  <title>Real Estate API Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
</head>

<body>
  <h3>Real estate data chart</h3>

  <script>
    function makeFakePriceNGN(user) {
      const text = user.address.city + user.company.name + user.username;

      let total = 0;
      for (let i = 0; i < text.length; i++) {
        total += text.charCodeAt(i);
      }

      const min = 30000000;
      const max = 160000000;
      const price = min + (total % (max - min));

      return Math.round(price / 1000000) * 1000000;
    }

    async function fetchAndPlot() {
      try {
        const res = await fetch("https://jsonplaceholder.typicode.com/users");
        const users = await res.json();

        let agents = users.map(u => {
          return {
            name: u.name.split(" ")[0],
            city: u.address.city,
            avgPrice: makeFakePriceNGN(u)
          };
        });

        agents.sort((a, b) => b.avgPrice - a.avgPrice);
        agents = agents.slice(0, 8);

        const chartData = agents.map(a => ({
          name: a.name + " (" + a.city + ")",
          value: a.avgPrice
        }));

        tfvis.render.barchart(
          { name: "Avg Property Price per Agent (NGN)", tab: "chart" },
          chartData,
          {
            xLabel: "Agent (City)",
            yLabel: "Avg price (â‚¦)",
            height: 400
          }
        );

      } catch (err) {
        console.log(err);
      }
    }

    fetchAndPlot();
  </script>
</body>
</html>
